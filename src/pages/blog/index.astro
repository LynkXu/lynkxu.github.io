---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { SITE_DESCRIPTION } from '../../consts';

const posts = (await getCollection('blog'))
	.filter((post) => !post.data.draft)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// 按年份分组文章
const postsByYear: Record<number, typeof posts> = {};
posts.forEach((post) => {
	const year = post.data.pubDate.getFullYear();
	if (!postsByYear[year]) {
		postsByYear[year] = [];
	}
	postsByYear[year].push(post);
});

// 获取所有年份并按降序排序
const years = Object.keys(postsByYear)
	.map(Number)
	.sort((a, b) => b - a);
---

<Base title='文章' description={SITE_DESCRIPTION}>
	<p></p>
	<h2>–</h2>
	<div class='posts-archive'>
		{
			years.map((year) => (
				<div class='year-group'>
					<h3 class='year-title'>{year}</h3>
					<ul class='posts'>
						{postsByYear[year].map((post) => (
							<li>
								<span>
									<FormattedDate date={post.data.pubDate} />
								</span>
								<div>
									<a href={`/blog/${post.id}.html`} transition:name={`post-title-${post.id}`}>
										{post.data.title}
									</a>
								</div>
							</li>
						))}
					</ul>
				</div>
			))
		}
	</div>
</Base>
