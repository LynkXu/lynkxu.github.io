---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import Page from '../layouts/Page.astro';
import Message from '../layouts/Message.astro';
import Shuoshuo from '../layouts/Shuoshuo.astro';
import Projects from '../layouts/Projects.astro';

export async function getStaticPaths() {
	const pages = await getCollection('page');
	const paths: Array<{ params: { slug: string }; props: CollectionEntry<'page'> }> = [];

	pages.forEach((page) => {
		// 添加主 slug
		paths.push({
			params: { slug: page.data.slug },
			props: page,
		});

		// 添加所有别名 slug
		if (page.data.aliases && Array.isArray(page.data.aliases)) {
			page.data.aliases.forEach((alias) => {
				paths.push({
					params: { slug: alias },
					props: page,
				});
			});
		}
	});

	return paths;
}

type Props = CollectionEntry<'page'>;

const page = Astro.props;
const { Content } = await render(page);

// 布局映射表：以后添加新布局只需在这里添加一行即可
const layoutMap: Record<string, any> = {
	Page, // 默认布局
	Message,
	Shuoshuo,
	Projects,
};

// 根据 layout 字段选择布局组件，如果未指定或找不到则使用 Page
const Layout = (page.data.layout && layoutMap[page.data.layout]) || Page;
---

<Layout title={page.data.title}>
	<Content />
</Layout>
