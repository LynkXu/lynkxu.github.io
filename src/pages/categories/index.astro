---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';

const allPosts = (await getCollection('blog')).filter((post) => !post.data.draft);
const categoriesMap = new Map();

// 统计每个分类的文章数量
allPosts.forEach((post) => {
	if (post.data.categories) {
		post.data.categories.forEach((category) => {
			categoriesMap.set(category, (categoriesMap.get(category) || 0) + 1);
		});
	}
});

// 按文章数量排序
const sortedCategories = Array.from(categoriesMap.entries()).sort((a, b) => b[1] - a[1]);
---

<Base title='分类' description='浏览所有文章分类'>
	<p></p>
	<h2>–</h2>
	<h1>分类</h1>
	<p>共 {sortedCategories.length} 个分类</p>
	<div class='post-content content'>
		<div class='categories-grid'>
			{
				sortedCategories.map(([category, count]) => (
					<div class='categories-item'>
						<a href={`/categories/${category}/`} class='category-item'>
							{category}
							<sup>({count})</sup>
						</a>
					</div>
				))
			}
		</div>
	</div>
</Base>
