---
import type { CollectionEntry } from 'astro:content';
import Base from './Base.astro';
import projectsData from '../content/page/projects.json';

type Props = CollectionEntry<'page'>['data'] & {
	content?: string;
};

const { title } = Astro.props;

// 定义项目类型
interface Project {
	name: string;
	description: string;
	url: string;
	image?: string;
	tags?: string[];
}

// 读取项目数据
const projects: Project[] = projectsData;

// 默认图片
const defaultImage = '/logo.png';
---

<Base title={title} description={title}>
	<p></p>
	<h2>–</h2>
	<h1>{title}</h1>
	<div class='post-content content'>
		<slot />
	</div>

	<div class='projects-container'>
		<!-- 项目列表 -->
		<div class='projects-grid'>
			{
				projects.length === 0 ? (
					<div class='empty-state'>暂无项目数据</div>
				) : (
					projects.map((project) => (
						<div class='card'>
							<a href={project.url || '#'} class='card-image' target='_blank' rel='noopener noreferrer'>
								<img src={project.image || defaultImage} alt={project.name} loading='lazy' />
							</a>
							<div class='card-content'>
								<h2 class='card-title'>
									<a href={project.url || '#'} target='_blank' rel='noopener noreferrer'>
										{project.name || '未命名项目'}
									</a>
								</h2>
								<p class='card-description'>{project.description}</p>
								{project.tags && project.tags.length > 0 && (
									<div class='card-tags'>
										{project.tags.map((tag) => (
											<span class='tag'>{tag}</span>
										))}
									</div>
								)}
							</div>
						</div>
					))
				)
			}
		</div>

		<h2 class='section-title'>GitHub Activity</h2>

		<!-- GitHub 活动 -->
		<section class='github-activity'>
			<div class='github-activity__chart'>
				<img
					src='https://ghchart.rshah.org/659eb9/lynkxu'
					alt='GitHub activity chart'
					loading='lazy'
				/>
			</div>
		</section>
	</div>
</Base>

<style>
	.projects-container .projects-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
		gap: 1.2rem;
		align-items: stretch;
	}

	.projects-container .github-activity {
		margin-top: 1.5rem;
		background: white;
		border-radius: 12px;
		padding: 12px;
		box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
		border: 1px solid rgba(0, 0, 0, 0.04);
	}

	.projects-container .github-activity__chart {
		margin-top: 10px;
		border-radius: 10px;
		overflow: hidden;
	}

	.projects-container .github-activity__chart img {
		width: 100%;
		display: block;
		border-radius: 10px;
		border: none;
		background: transparent;
		padding: 0;
		box-shadow: none;
	}

	.projects-container .section-title {
		margin: 1.5rem 0 0.5rem;
		font-size: 18px;
		font-weight: 600;
		color: #333;
	}

	.projects-container .card {
		position: relative;
		background: white;
		border-radius: 12px;
		overflow: hidden;
		box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
		transition:
			transform 0.3s ease,
			box-shadow 0.3s ease;
		display: flex;
		flex-direction: column;
	}

	.projects-container .card:hover {
		transform: translateY(-5px);
		box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
	}

	.projects-container .card-image {
		display: flex;
		width: 100%;
		aspect-ratio: 16/10;
		overflow: hidden;
		border: none;
	}

	.projects-container .card-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.5s ease;
	}

	.projects-container .card:hover .card-image img {
		transform: scale(1.01);
	}

	.projects-container .card-content {
		padding: 16px;
		display: flex;
		flex-direction: column;
		gap: 8px;
		flex: 1;
	}

	.projects-container .card-title {
		margin: 0;
		color: #333;
		font-weight: 500;
		font-size: 18px;
	}

	.projects-container .card-title a {
		color: var(--site-title-color);
		text-decoration: none;
	}

	.projects-container .card-description {
		color: #666;
		font-size: 14px;
		line-height: 1.5;
		margin: 0;
		font-weight: 300;
	}

	.projects-container .card-action {
		display: flex;
		justify-content: flex-end;
	}

	.projects-container .btn {
		display: inline-block;
		background: linear-gradient(135deg, #6e8efb, #4a6cf7);
		color: white;
		text-decoration: none;
		padding: 10px 20px;
		border-radius: 50px;
		font-weight: 500;
		font-size: 0.9rem;
		transition: all 0.3s ease;
		box-shadow: 0 4px 10px rgba(74, 108, 247, 0.3);
	}

	.projects-container .btn:hover {
		background: linear-gradient(135deg, #4a6cf7, #2758f5);
		box-shadow: 0 6px 15px rgba(74, 108, 247, 0.4);
		transform: translateY(-2px);
	}

	.projects-container .error-message {
		grid-column: 1/-1;
		text-align: center;
		padding: 30px;
		background: #fff1f0;
		color: #f56c6c;
		border-radius: 8px;
		font-size: 1.1rem;
	}

	.projects-container .empty-state {
		grid-column: 1/-1;
		text-align: center;
		padding: 50px;
		color: #909399;
		font-size: 1.1rem;
		background: #f8f9fa;
		border-radius: 8px;
	}

	.projects-container .card-tags {
		display: flex;
		flex-wrap: wrap;
		gap: 6px;
		margin-top: auto;
	}

	.projects-container .tag {
		display: inline-block;
		padding: 3px 8px;
		font-size: 12px;
		border-radius: 16px;
		background-color: #f0f5ff;
		color: #4a6cf7;
		font-weight: 500;
		transition: all 0.2s ease;
		line-height: 1.7;
	}

	.projects-container .tag:hover {
		background-color: #d6e4ff;
		transform: translateY(-2px);
	}

	@media (max-width: 768px) {
		.projects-container .projects-grid {
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
		}

		.projects-container .github-activity__chart img {
			max-width: 100%;
		}
	}
</style>
